<?xml version="1.0" encoding="UTF-8"?>

<!-- our layer generator will write this document. -->
<!-- per the NOe WMS design doc, we will aggregate netcdf files with the same model, aoi, params and dims into a single ncml file -->
<!-- we want this file to contain all info we need to respond to getCap request w/o having to access the aggregated nc filesv-->
<!--   - currently that is analysis time (runtime), time, elevation(depth) -->
<!-- for coordinate values that are the same across the aggregated files, specify in doc section (example: depth).  -->
<!-- for coordinate values that vary across files, specify within each file's element (example here: time). -->

<netcdf xmlns="http://www.unidata.ucar.edu/namespaces/netcdf/ncml-2.2" >
  <dimension name="latitude" length="3" />
  <dimension name="longitude" length="3" />
  <dimension name="depth" length="5" />  
  <dimension name="time" length="5" />

  <variable name="depth" shape="depth" type="double">
    <attribute name="long_name" value="Depth" />
    <attribute name="units" value="meter" />
    <attribute name="NAVO_code" type="int" value="5" />
    <attribute name="positive" value="down" />
    <values>0.0 50.0 100.0 250.0 500.0</values>
  </variable>
  
  <!-- specify the variable for the new dimension, esp. so we can specify the coordinate values. -->
  <variable name="runtime" type="String" >
    <attribute name="long_name" value="Run time for model" />
    <attribute name="standard_name" value="forecast_reference_time" />
    <attribute name="_CoordinateAxisType" value="RunTime" />
    <!-- for now, comment out here, see how it goes with coordValue set on each netcdf below (see comment there) -->
    <!-- <values>2000-01-03T00:00:00.000Z 2000-01-04T00:00:00.000Z</values> -->
  </variable>  

  <!--list each nc file we are aggregating, and any file specific info for each.-->
  <aggregation dimName="runtime" type="joinNew">
    <!-- existing variables to aggregate on -->
    <variableAgg name="temp"/>
    <variableAgg name="time"/>
    <variableAgg name="tau"/>
    <!-- nested aggregation of files for run 1 -->
    <!-- for the nested aggregation, get NPE if do not put the coordValue attribute here -->
	<netcdf coordValue="2000-01-03T00:00:00.000Z">
	    <aggregation dimName="time" type="joinExisting">
		    <netcdf location="modelRun1Tau00agg.nc" >
		      <variable name="time" shape="time" type="double">
		        <attribute name="long_name" value="Valid Time" />
		        <attribute name="units" value="hour since 2000-01-01 00:00:00" />
		        <attribute name="NAVO_code" type="int" value="13" />
		        <attribute name="time_origin" value="2000-01-01 00:00:00" />
		        <values>48.0</values>
		      </variable>
		    </netcdf>
		    <netcdf location="modelRun1Tau12agg.nc" >
		      <variable name="time" shape="time" type="double">
		        <attribute name="long_name" value="Valid Time" />
		        <attribute name="units" value="hour since 2000-01-01 00:00:00" />
		        <attribute name="NAVO_code" type="int" value="13" />
		        <attribute name="time_origin" value="2000-01-01 00:00:00" />
		        <values>60.0</values>
		      </variable>
		    </netcdf>
		    <netcdf location="modelRun1Tau24agg.nc" >
		      <variable name="time" shape="time" type="double">
		        <attribute name="long_name" value="Valid Time" />
		        <attribute name="units" value="hour since 2000-01-01 00:00:00" />
		        <attribute name="NAVO_code" type="int" value="13" />
		        <attribute name="time_origin" value="2000-01-01 00:00:00" />
		        <values>72.0</values>
		      </variable>
		    </netcdf>
		    <netcdf location="modelRun1Tau36agg.nc" >
		      <variable name="time" shape="time" type="double">
		        <attribute name="long_name" value="Valid Time" />
		        <attribute name="units" value="hour since 2000-01-01 00:00:00" />
		        <attribute name="NAVO_code" type="int" value="13" />
		        <attribute name="time_origin" value="2000-01-01 00:00:00" />
		        <values>84.0</values>
		      </variable>
		    </netcdf>
		    <netcdf location="modelRun1Tau48agg.nc" >
		      <variable name="time" shape="time" type="double">
		        <attribute name="long_name" value="Valid Time" />
		        <attribute name="units" value="hour since 2000-01-01 00:00:00" />
		        <attribute name="NAVO_code" type="int" value="13" />
		        <attribute name="time_origin" value="2000-01-01 00:00:00" />
		        <values>96.0</values>
		      </variable>
		    </netcdf>
	    </aggregation>
    </netcdf>
    <!-- nested aggregation of files for run 2 -->
    <netcdf coordValue="2000-01-04T00:00:00.000Z">
	    <aggregation dimName="time" type="joinExisting">
		    <netcdf location="modelRun2Tau00agg.nc" >
		      <variable name="time" shape="time" type="double">
		        <attribute name="long_name" value="Valid Time" />
		        <attribute name="units" value="hour since 2000-01-01 00:00:00" />
		        <attribute name="NAVO_code" type="int" value="13" />
		        <attribute name="time_origin" value="2000-01-01 00:00:00" />
		        <values>72.0</values>
		      </variable>
		    </netcdf>
		    <netcdf location="modelRun2Tau12agg.nc" >
		      <variable name="time" shape="time" type="double">
		        <attribute name="long_name" value="Valid Time" />
		        <attribute name="units" value="hour since 2000-01-01 00:00:00" />
		        <attribute name="NAVO_code" type="int" value="13" />
		        <attribute name="time_origin" value="2000-01-01 00:00:00" />
		        <values>84.0</values>
		      </variable>
		    </netcdf>
		    <netcdf location="modelRun2Tau24agg.nc" >
		      <variable name="time" shape="time" type="double">
		        <attribute name="long_name" value="Valid Time" />
		        <attribute name="units" value="hour since 2000-01-01 00:00:00" />
		        <attribute name="NAVO_code" type="int" value="13" />
		        <attribute name="time_origin" value="2000-01-01 00:00:00" />
		        <values>96.0</values>
		      </variable>
		    </netcdf>
		    <netcdf location="modelRun2Tau36agg.nc" >
		      <variable name="time" shape="time" type="double">
		        <attribute name="long_name" value="Valid Time" />
		        <attribute name="units" value="hour since 2000-01-01 00:00:00" />
		        <attribute name="NAVO_code" type="int" value="13" />
		        <attribute name="time_origin" value="2000-01-01 00:00:00" />
		        <values>108.0</values>
		      </variable>
		    </netcdf>
		    <netcdf location="modelRun2Tau48agg.nc" >
		      <variable name="time" shape="time" type="double">
		        <attribute name="long_name" value="Valid Time" />
		        <attribute name="units" value="hour since 2000-01-01 00:00:00" />
		        <attribute name="NAVO_code" type="int" value="13" />
		        <attribute name="time_origin" value="2000-01-01 00:00:00" />
		        <values>120.0</values>
		      </variable>
		    </netcdf>
	    </aggregation>
    </netcdf>
  </aggregation>
</netcdf>